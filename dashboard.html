<!DOCTYPE html>
input { padding:6px; border-radius:6px; }
</style>
</head>
<body>


<h1>ðŸ“Š BTC Hourly Polymarket Markets</h1>


<label>Alert above price: </label>
<input id="alertPrice" type="number" step="0.01">


<div id="markets"></div>


<script>
const ws = new WebSocket(`wss://${location.host}/ws`);
const charts = {};
let alertPrice = null;


document.getElementById("alertPrice").onchange = e => {
alertPrice = parseFloat(e.target.value);
};


ws.onmessage = (event) => {
const data = JSON.parse(event.data);
const prices = data.prices;
const labels = data.labels;


for (const label in labels) {
const token = labels[label];
const p = prices[token];
if (!p) continue;


if (!charts[token]) createMarket(label, token);


const mid = p.history[p.history.length - 1];
charts[token].data.labels.push("");
charts[token].data.datasets[0].data.push(mid);
charts[token].update();


if (alertPrice && mid >= alertPrice) {
alert(`ðŸš¨ Price Alert: ${label} reached ${mid}`);
alertPrice = null;
}
}
};


function createMarket(label, token) {
const div = document.createElement("div");
div.className = "card";


div.innerHTML = `<h3>${label}</h3><canvas id="c${token}"></canvas>`;
document.getElementById("markets").appendChild(div);


const ctx = document.getElementById(`c${token}`).getContext("2d");


charts[token] = new Chart(ctx, {
type: "line",
data: {
labels: [],
datasets: [{
label: "Mid Price",
data: [],
borderColor: "#22c55e",
tension: 0.3
}]
}
});
}
</script>


</body>
</html>